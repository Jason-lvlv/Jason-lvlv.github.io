<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    body {
        font-family: system-ui;
        background: #f06d06;
        color: white;
        text-align: center;
        transition: all .5s ease-out;
    }
    h1 {
        --shadow-x: 3px;  
        --shadow-y: 4px;
        --deg-x: 0deg;
        --deg-y: 0deg;
        position: absolute;
        top: 50%;
        left: 50%;
        font-size: 6vw;
        text-shadow: black var(--shadow-x) var(--shadow-y) 5px;
        transform: translateY(-50%) translateX(-50%) rotateX(var(--deg-x)) rotateY(var(--deg-y));
    }
    .show {
        background: black;
        color: white;
        border: 1px solid black;
        border-radius: 5vw;
        padding: 1vw 2vw;  
        font-size: 3vw;
    }
    .ball {
        --deg: 45deg;
        --ball-x: 0px;
        --ball-y: 0px;
        display: flex;
        top: var(--ball-y);
        left: var(--ball-x);
        position: absolute;
        background: radial-gradient(circle at 15px 15px, skyblue, darkblue);
        border-radius: 50%;
        height: 50px;
        width: 50px;
        z-index: -1;
        /*   transition: all .3s ease-out; */
    }
    .ball:after {
        content: "";
        display: block;
        position: inherit;
        top: 15px;
        left: 15px;
        width: 1.08rem;
        height: 1.08rem;
        box-sizing: border-box;
        border-right: 5px solid white;
        border-bottom: 5px solid white;
        transform: rotate(var(--deg)) skew(15deg, 15deg);
        /* --degç»§æ‰¿è‡ªçˆ¶é€‰æ‹©å™¨ */
    }
    /* span {
        display: block;
        width: 60px;
        height: 20px;
        background-color: #f00;
        color: black;
    } */
</style>
<body>
    <h1 id="title">ğŸ‘‹ Hello World!</h1>
    <p id="info" class="show">
    <span id="alpha"></span>
    <span id="beta"></span>
    <span id="gamma"></span>
    <span id="deg"></span>
    </p>
    <div id="ball"></div>

</body>

<script>
    /* å…¨å±€å˜é‡ï¼ŒcalcOffsetå‡½æ•°å†…æ›´æ–° */
    var offsetX = 0;
    var offsetY = 0;
    var deg = 0;

    ax = 5; ay = 10; // è‡ªå®šä¹‰xã€yæ–¹å‘ä¸Šçš„åŠ é€Ÿåº¦
    xmax = document.documentElement.clientWidth - 50;
    ymax = document.documentElement.clientHeight - 50;

    // æ£€æŸ¥æ‰‹æœºæ˜¯å¦æ”¯æŒ
    if (window.DeviceOrientationEvent) {
        window.addEventListener('deviceorientation', (event) => {

            if (event.alpha == null) {    // PCç«¯æç¤º
                info = document.getElementById('info');
                info.innerHTML = 'DeviceOrientationæ¥å£å›ä¼ çš„æ•°æ®ä¸ºç©º';
                info.setAttribute('class', 'show');
                return;
            }
            
            /* æ ¹æ®betaå’Œgammaå€¼çš„å˜åŒ–æ›´æ–°åç§»å€¼ */
            calcOffset(event.beta, event.gamma);
            
            /* æ˜¾ç¤ºå½“ä¸‹çš„å€¼ */
            document.getElementById('alpha').innerHTML = 'x = ' + (event.alpha).toFixed(2); // ä¸œå—è¥¿åŒ—æœå‘ï¼Œæ­£åŒ—ä¸º360/0
            document.getElementById('beta').innerHTML = 'y = ' + event.beta.toFixed(2); // æ‰‹æœºç«–å‘ç«‹å€’
            document.getElementById('gamma').innerHTML = 'z = ' + (event.gamma).toFixed(2); // æ‰‹æœºæ¨ªå‘ç«‹å€’    
            document.getElementById('deg').innerHTML = 'deg = ' + -( deg + 45 ).toFixed(2); // ç›¸å¯¹xè½´å¤¹è§’
            // æ˜¾ç¤ºå½“å‰çš„å„é¡¹æ•°æ®
            spans = document.getElementsByTagName('span');
            for (item of spans)
            item.setAttribute('class', 'show');
            
            /* æ ¹æ®åç§»é‡çš„å˜åŒ–æ”¹å˜é˜´å½±ä½ç½® */
            title = document.getElementById('title');
            title.style.setProperty('--shadow-x', `${offsetX * 15}px`); // æ•°å€¼èŒƒå›´ï¼š-90~90
            title.style.setProperty('--shadow-y', `${offsetY * 15}px`); // æ•°å€¼èŒƒå›´ï¼š-180~180    
            title.style.setProperty('--deg-x', `${-offsetY * 20}deg`);
            title.style.setProperty('--deg-y', `${-offsetX * 40}deg`);
            
            /* æ ¹æ®åç§»é‡çš„å˜åŒ–æ”¹å˜å°çƒä½ç½® */    
            ball = document.getElementById('ball');
            ball.setAttribute('class', 'ball');  // æ˜¾ç¤ºå°çƒ
            ball.style.setProperty('--deg', `${deg}deg`);
            // è·å–åŸä½ç½®ï¼Œæ ¹æ®åç§»é‡è®¡ç®—æ–°ä½ç½®
            ballX = Number(ball.style.getPropertyValue("--ball-x").replace(' ','').replace('px','')) + ax * offsetX;
            ballY = Number(ball.style.getPropertyValue("--ball-y").replace(' ','').replace('px','')) + ay * offsetY;
            // åˆ·æ–°å°çƒä½ç½®ï¼Œå¹¶é˜²æ­¢å°çƒè¶Šç•Œ
            ball.style.setProperty('--ball-x', `${ballX < 0 ? 0 : (ballX > xmax ? xmax : ballX)}px`);
            ball.style.setProperty('--ball-y', `${ballY < 0 ? 0 : (ballY > ymax ? ymax : ballY)}px`);
        }, false);
    } else {
        alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒDeviceOrientationæ¥å£');
    }

    function calcOffset(beta, gamma) {
        offsetX = Math.sin(( Math.abs(beta) < 90 ? gamma : -gamma ) * Math.PI / 180 );  // - 90 < beta < 90 æ—¶ï¼Œæ‰‹æœºæœä¸Š
        offsetY = Math.sin( beta * Math.PI / 180 );
        
        // è¿™é‡Œéœ€è¦ç”¨åˆ°ä½ å°å­¦äºŒå¹´çº§å­¦è¿‡çš„ç›´è§’åæ ‡è½¬æåæ ‡çš„æ–¹æ³•
        // æœ€åçš„-45æ˜¯ä¸ºäº†è®©ç®­å¤´åˆå§‹æŒ‡å‘xè½´æ­£æ–¹å‘
        // cssçš„rotate()å‡½æ•°æ—‹è½¬çš„æ–¹å‘å’Œæåæ ‡ç³»æ˜¯ç›¸åçš„
        // åŒæ ·ï¼Œtext-shadowé˜´å½±çš„offsetYä¹Ÿä¸yè½´æ˜¯ç›¸åçš„
        deg = -Math.atan( -offsetY / offsetX ) * 180 / Math.PI + ( offsetX < 0 ? -180 : 0 ) - 45;
    }
</script>
</html>